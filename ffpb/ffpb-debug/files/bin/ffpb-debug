#!/bin/sh                                                           

export tf=`mktemp`                                                  
                                                                    
echo "--- START sysinfo ---" >>$tf                                  
echo -en "Hostname = " >> $tf                                       
uname -n >> $tf                                                     
echo -en "Gluon Release = " >> $tf                                  
cat /lib/gluon/release >> $tf                                       
echo -en "Uptime = " >> $tf                                         
uptime >> $tf                                                       
echo -en "Timestamp = " >> $tf                                      
date >> $tf                                                         
echo "--- END sysinfo ---\n" >>$tf                                  
echo >> $tf                                                         
                                                                    
cmd() {                                                             
        echo "--- START $* ---" >> $tf                              
        $* 2>&1 >> $tf                                              
        echo "--- END ($?) $* ---" >> $tf                           
        echo >> $tf                                                 
}                                                                   
                                                                    
cmd ip addr show                                                    
cmd ip route show                                                   
cmd iw phy phy0 info
cmd iw dev wlan0 info                                               
cmd iw dev wlan0 station dump                                       
cmd batctl gwl                                                      

local=false
while getopts l opt
do
	case $opt in
		l)
			local=true;;
	esac
done

if $local ; then
	cat $tf
	echo "I will not send any information to ffpb-team"
else
	echo "Sending report to ffpb-team"
	code=`nc debug.paderborn.freifunk.net 1337 < $tf`
	echo "Report number:"
	echo $code
fi
