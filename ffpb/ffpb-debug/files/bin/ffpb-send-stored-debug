#!/bin/sh
#
# Stefan Kloepping <northalpha@c3pb.de>
#  --  Do 29 Mai 21:21:55 2014
#
stored_debug_file='/var/cache/ff/debug/stored.ff-debug.gz'

#if file is not present, there is nothing to do
if [ ! -f "{$stored_debug_file}" ];then
	exit 0
fi

#send stored debug data to server
HOST=$(lua -e 'print(require("gluon.site_config").debugserver.host)')
PORT=$(lua -e 'print(require("gluon.site_config").debugserver.port)')
code=$(nc $HOST $PORT < "${stored_debug_file}")
if [ $? = 0 ]; then
        echo "Report number: ${code}" > /var/cache/ff/debug/lastreport.code
	rm -f -- "${stored_debug_file}"
fi
